{% extends "base.html" %}
{% block title %}Study Sessions{% endblock %}

{% block head %}
<style>
    .sessions-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .tabs {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .tab-btn {
        padding: 0.5rem 1.2rem;
        font-size: 1rem;
        border-radius: 20px;
        border: none;
        cursor: pointer;
        background-color: #e5e7eb;
        transition: 0.25s ease;
    }

    .tab-btn.active {
        background-color: #2E8857;
        color: white;
    }

    .tab-btn:hover {
        background-color: #d1d5db;
    }

    .session-card {
        background: #ffffff;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        border-left: 6px solid #2E8857;
    }

    .session-title {
        font-size: 1.4rem;
        font-weight: bold;
        color: #2E8857;
        margin-bottom: 0.3rem;
    }

    .session-details {
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .session-type {
        font-size: 0.9rem;
        font-weight: 600;
        padding: 0.2rem 0.5rem;
        border-radius: 5px;
        display: inline-block;
        margin-bottom: 0.6rem;
    }

    .public-tag {
        background-color: #d1fae5;
        color: #065f46;
    }

    .private-tag {
        background-color: #fee2e2;
        color: #991b1b;
    }

    .join-btn {
        margin-top: 1rem;
        padding: 0.5rem 1.2rem;
        background-color: #2E8857;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .empty-message {
        text-align: center;
        color: #6b7280;
        padding: 2rem 0;
    }
</style>
{% endblock %}

{% block content %}

<h2 style="color:#2E8857; text-align:center;">Study Sessions</h2>
{% if session.get('user') %}
<div style="text-align:center; margin-bottom: 1.5rem;">
    <a href="{{ url_for('create_session', usr=session.get('user')) }}"
       style="background:#2E8857;
              color:white;
              padding:0.6rem 1.4rem;
              border-radius:8px;
              text-decoration:none;
              font-weight:600;
              display:inline-block;">
        ➕ Create Study Session
    </a>
</div>
{% endif %}

<div class="tabs">
    <button class="tab-btn active" onclick="showTab('all')">All Sessions</button>
    <button class="tab-btn" onclick="showTab('my')">My Sessions</button>
    <button class="tab-btn" onclick="showTab('upcoming')">Upcoming</button>
</div>

<div class="sessions-container">
    <!-- ALL -->
    <div class="tab-content" id="all">
        {% for s in sessions %}
            <div class="session-card">
                <div class="session-title">
    <a href="{{ url_for('session_detail', session_id=s.id) }}"
       style="color:#2E8857;text-decoration:none;">
        {{ s.title }}
    </a>
</div>

                <div class="session-details">
                    {{ s.subject }} • {{ s.date_time }} • {{ s.location }}
                </div>
                <form method="POST" action="{{ url_for('join_session', session_id=s.id) }}">
                    <button class="join-btn">Join Session</button>
                </form>
            </div>
        {% else %}
            <p class="empty-message">No sessions available.</p>
        {% endfor %}
    </div>

    <!-- MY -->
    <div class="tab-content" id="my" style="display:none;">
    {% for s in my_sessions %}
        <div class="session-card">
            <div class="session-title">
                <a href="{{ url_for('session_detail', session_id=s.id) }}"
                   style="color:#2E8857;text-decoration:none;">
                    {{ s.title }}
                </a>
            </div>

            <div class="session-details">
                {{ s.subject }} • {{ s.date_time }} • {{ s.location }}
            </div>

            {% if current_user and s.creator_id == current_user.id %}
                <span class="session-type public-tag">You created this</span>
            {% else %}
                <span class="session-type private-tag">Joined</span>
            {% endif %}
        </div>
    {% else %}
        <p class="empty-message">You haven’t created or joined any sessions yet.</p>
    {% endfor %}
</div>


    <!-- UPCOMING -->
    <div class="tab-content" id="upcoming" style="display:none;">
        {% for s in upcoming %}
            <div class="session-card">{{ s.title }}</div>
        {% else %}
            <p class="empty-message">No upcoming sessions.</p>
        {% endfor %}
    </div>
</div>

<script>
function showTab(name) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(div => {
        div.style.display = 'none';
    });

    // Show selected tab
    document.getElementById(name).style.display = 'block';

    // Remove active class from all buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    // Activate the clicked button
    const btnMap = { all: 0, my: 1, upcoming: 2 };
    document.querySelectorAll('.tab-btn')[btnMap[name]].classList.add('active');
}
</script>




{% endblock %}